#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# Web checks
echo "ğŸ“¦ Web: Running lint..."
cd apps/web && npm run lint
if [ $? -ne 0 ]; then
    echo "âŒ Web lint failed. Push aborted."
    exit 1
fi

echo "ğŸ”¨ Web: Building..."
npm run build
if [ $? -ne 0 ]; then
    echo "âŒ Web build failed. Push aborted."
    exit 1
fi

cd ../..

# API checks
echo "â˜• API: Running checkstyle..."
cd apps/api && ./mvnw checkstyle:check -q
if [ $? -ne 0 ]; then
    echo "âŒ API checkstyle failed. Push aborted."
    exit 1
fi

echo "ğŸ§ª API: Running tests..."
./mvnw test -Dquarkus.test.continuous-testing=disabled -q
if [ $? -ne 0 ]; then
    echo "âŒ API tests failed. Push aborted."
    exit 1
fi

echo "ğŸ”¨ API: Building..."
./mvnw package -DskipTests -q
if [ $? -ne 0 ]; then
    echo "âŒ API build failed. Push aborted."
    exit 1
fi

echo "âœ… All pre-push checks passed!"
